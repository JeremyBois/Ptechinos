units:
  kx: cx # 18mm Choc spacing
  ky: cy # 17mm Choc spacing
  spreadX: cx + 1
  spreadY: cy + 1
  px: 2
  py: 2

  # visual_x/_y are built in units
  # keycaps size in demo.dxf
  visual_x: cx
  visual_y: cy
points:
  zones:
    matrix:
      key.padding: spreadY
      columns:
        pinky:
          origin: [ 0, -1ky ]
          stagger: 0 ky
          rotate: 8
          key:
            column_net: P20
          rows:
            top:
              shift: [-spreadX, -spreadY]
              bind: [0, px, 0, 0]
            home:
              shift: [0, 0]
              bind: [3py+ky, 3px, py, 2.5px]
            bottom:
              shift: [0, 0]
              bind: [0, px, 0, 0]
            top_encoder:
              shift: [0, -spreadY]
              bind: [0, px, 0, 0]
        ring:
          origin: [ 0, -1ky ]
          stagger: 0.6 ky
          spread: kx
          rotate: -6
          key:
            column_net: P19
            bind: [0, 2px, py, 0]
        middle:
          origin: [ 0, -1ky ]
          stagger: 0.2 ky
          spread: 0.98spreadX
          rotate: -2
          key:
            column_net: P18
            bind: [py, px, py, px]
        index:
          origin: [ 0, -1ky ]
          stagger: -0.3 ky
          spread: kx
          rotate: -4
          key:
            column_net: P15
            bind: [2.2py, 0, py, 3px]
        inner:
          origin: [ 0, -1ky ]
          stagger: -0.1 ky
          spread: spreadX
          key:
            column_net: P14
            bind: [1.5py, 0.5px, py, px]
      rows:
        bottom:
          row_net: P6
        home:
          row_net: P5
        top:
          row_net: P4
    thumbfan:
      anchor:
        ref: matrix_inner_bottom
        shift: [-1.4kx, -1.63ky]
      columns:
        near:
          spread: spreadX
          origin: [3.6kx, 1.4ky]
          rotate: -3
          key:
            column_net: P19
        home:
          spread: spreadX
          rotate: -15
          origin: [-kx, -0.9ky]
          key:
            column_net: P18
        far:
          spread: spreadX
          rotate: -15
          origin: [-kx, -0.9ky]
          key:
            column_net: P15
      rows:
        thumb:
          row_net: P7
    bottom_encoder:
      anchor:
        ref: thumbfan_home_thumb
        shift: [1.9, 1.34ky]
      columns:
        far:
          key:
            column_net: P14
      rows:
        bottom:
          row_net: P6
outlines:
  exports:
    raw:
      - type: keys
        side: left
        size: [kx, ky]
        corner: px
    _thumbfan_glue:
      - type: polygon
        points:
          - ref: thumbfan_far_thumb
            shift: [0.62kx, 0.5 ky ]
          - ref: thumbfan_far_thumb
            shift: [0.62kx, -0.5 ky]
          - ref: thumbfan_near_thumb
            shift: [0.5 px, -0.7 ky]
          - ref: matrix_pinky_bottom
            shift: [-0.5kx, -0.71ky]
          - ref: matrix_pinky_bottom
            shift: [-1.53kx, 0.4ky]
          - ref: matrix_pinky_top
            shift: [-0.7kx, 0.5ky]
          - ref: matrix_ring_top
            shift: [-0.6kx, 0.7ky]
          - ref: matrix_ring_top
            shift: [kx, 0.7ky]
          - ref: matrix_inner_home
            shift: [0, -1.25ky]
          - ref: matrix_inner_home
            shift: [2.08kx, -1.87ky]
    _rounded_thumbfan_glue:
      # Apply a fillet to the polygon specified above to round the corners
      - type: outline
        name: _thumbfan_glue
        fillet: 3px
    _controller_area:
      - type: polygon
        points:
          - ref: matrix_inner_home
            shift: [0.2kx, -1.5ky]
          - ref: matrix_inner_top
            shift: [0.55kx, 0.64ky]
          - ref: matrix_inner_top
            shift: [0.56kx, 0.62ky]
          - ref: matrix_inner_top
            shift: [0.57kx, 0.61ky]
          - ref: matrix_inner_top
            shift: [0.6kx, 0.605ky]
          - ref: matrix_inner_top
            shift: [47, 0.753ky]
          - ref: matrix_inner_bottom
            shift: [36.8, -25]
    _rounded_controller_area:
      # Apply a fillet to the polygon specified above to round the corners
      - type: outline
        name: _controller_area
        fillet: 1px
    _top_encoder_exclude:
      main:
        type: rectangle
        anchor:
          ref:
            - matrix_pinky_top_encoder
          # Shift 1 pixel on the right because key not centered
          shift: [-8.1, -7.25]
        size: [17.85, 14.5]
    _bottom_encoder_cutout:
      main:
        type: rectangle
        anchor:
          ref:
            - bottom_encoder_far_bottom
          shift: [-8.5, -11]
        size: [14, 17]
    _bottom_encoder_exclude:
      main:
        type: rectangle
        anchor:
          ref:
            - bottom_encoder_far_bottom
          shift: [-10, -11.75]
        size: [17, 22]
    _bottom_encoder_exclude_top_plate:
      main:
        type: rectangle
        anchor:
          ref:
            - bottom_encoder_far_bottom
          shift: [0, -1.3]
        size: [20, 10]
    _rounded_encoder_exclude:
      # Apply a fillet to the polygon specified above to round the corners
      - type: outline
        name: _bottom_encoder_exclude
        fillet: 1px
      - type: outline
        name: _bottom_encoder_exclude_top_plate
        fillet: 1px
      - type: outline
        name: _top_encoder_exclude
    _screw_holes:
      top_left:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [-33.88, 14.42]
        radius: 1.1
      bottom_left:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [-52.8, -32.45]
        radius: 1.1
      top_right:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [31.155, 2.05]
        radius: 1.1
      bottom_right:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [29.25, -38.58]
        radius: 1.1
      thumb:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [68.48, -51.69]
        radius: 1.1
    _magnet_holes:
      top:
        type: circle
        anchor:
          - ref: matrix_inner_top
            shift: [0.3kx, 0]
        radius: 7.5
      center:
        type: circle
        anchor:
          - ref: matrix_pinky_home
            shift: [0, 0]
        radius: 7.5
      bottom:
        type: circle
        anchor:
          - ref: matrix_inner_bottom
            shift: [0.3kx, -1.25ky]
        radius: 7.5
    _puck_hole:
      center:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [9.225, -12.1]
        radius: 20.5
    _mounting_holes:
      $extends: outlines.exports._screw_holes
      top_left:
        radius: 1.9
      bottom_left:
        radius: 1.9
      top_right:
        radius: 1.9
      bottom_right:
        radius: 1.9
      thumb:
        radius: 1.9
    _guard_holes:
      guard_top:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [74.510, 16.82]
        radius: 1.1
      guard_bottom_left:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [53.19, -23.29]
        radius: 1.1
      guard_bottom_right:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [73.57, -31.94]
        radius: 1.1
    _pcb_holes:
      mounting_holes:
        type: outline
        name: _mounting_holes
        operation: add
      guard_holes:
        type: outline
        name: _guard_holes
        operation: add
    _switches:
      main:
        type: keys
        side: left
        size: 14 # 14mmx14mm cutouts will fit Choc and MX switches
        bound: false
    _keywell:
      main:
        type: outline
        name: raw
        fillet: 1
      thumbfan:
        type: outline
        name: _rounded_thumbfan_glue
        operation: add
    _base:
      main:
        type: outline
        name: _keywell
        fillet: 1
    trackpad:
      pad:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [70, -0.4ky]
        radius: 17.5
    bottom_plate:
      main:
        type: outline
        name: _base
      controller:
        type: outline
        name: _rounded_controller_area
        operation: add
      screw_holes:
        type: outline
        name: _screw_holes
        operation: subtract
      puck_hole:
        type: outline
        name: _puck_hole
        operation: subtract
      magnet_holes:
        type: outline
        name: _magnet_holes
        operation: subtract
    top_plate:
      main:
        type: outline
        name: _base
      switches:
        type: outline
        name: _switches
        operation: subtract
      screw_holes:
        type: outline
        name: _screw_holes
        operation: subtract
      encoder_exclude:
        type: outline
        name: _rounded_encoder_exclude
        operation: subtract
    pcb:
      main:
        type: outline
        name: _base
      controller:
        type: outline
        name: _rounded_controller_area
        operation: add
    keycaps:
      main:
        type: outline
        name: _base
      encoder_exclude:
        type: outline
        name: _rounded_encoder_exclude
        operation: subtract
      caps:
        type: keys
        side: left
        size: [cx, cy]
        bound: false
        corner: 1
        operation: stack
    preview:
      main:
        type: outline
        name: pcb
      top:
        type: outline
        name: top_plate
        operation: subtract
      guard_holes:
        type: outline
        name: _guard_holes
        operation: stack
      pcb_holes:
        type: outline
        name: _pcb_holes
        operation: stack
      puck_hole:
        type: outline
        name: _puck_hole
        operation: stack
      magnet_holes:
        type: outline
        name: _magnet_holes
        operation: stack
      encoder:
        type: outline
        name: _bottom_encoder_cutout
        operation: stack
      trackpad:
        type: outline
        name: trackpad
        operation: stack
cases:
  bottom_plate:
    - name: bottom_plate
      extrude: 3
      rotate: [0, 0, 0]
      shift: [0, 0, 0]
  top_plate:
    - name: top_plate
      extrude: 1.2
      rotate: [0, 0, 0]
      shift: [0, 0, 0]
