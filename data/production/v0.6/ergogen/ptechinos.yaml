units:
  kx: cx # 18mm Choc spacing
  ky: cy # 17mm Choc spacing
  spreadX: cx + 0.5  # 1mm between caps
  spreadY: cy + 0.5  # 1mm between caps
  capsX: cx - 0.5  # 17.5mm
  capsY: cy - 0.5  # 16.5mm
  px: 2
  py: 2

  # visual_x/_y are built in units
  # keycaps size in demo.dxf
  visual_x: cx
  visual_y: cy
points:
  zones:
    matrix:
      key.padding: spreadY
      columns:
        pinky:
          origin: [ 0, -1ky ]
          stagger: 0 ky
          rotate: 8
          key:
            column_net: P20
          rows:
            top:
              shift: [-spreadX, -spreadY]
              bind: [0, px, 0, 0]
            home:
              shift: [0, 0]
              bind: [3py+ky, 3px, py, 2.5px]
            bottom:
              shift: [0, 0]
              bind: [0, px, 0, 0]
            top_encoder:
              shift: [0, -spreadY]
              bind: [0, px, 0, 0]
        ring:
          origin: [ 0, -1ky ]
          stagger: 0.6 ky
          spread: kx
          rotate: -6
          key:
            column_net: P19
            bind: [0, 2px, py, 0]
        middle:
          origin: [ 0, -1ky ]
          stagger: 0.2 ky
          spread: 0.98spreadX
          rotate: -2
          key:
            column_net: P18
            bind: [py, px, py, px]
        index:
          origin: [ 0, -1ky ]
          stagger: -0.3 ky
          spread: kx
          rotate: -4
          key:
            column_net: P15
            bind: [2.2py, 0, py, 3px]
        inner:
          origin: [ 0, -1ky ]
          stagger: -0.1 ky
          spread: spreadX
          key:
            column_net: P14
            bind: [1.85py, 0.5px, py, px]
      rows:
        bottom:
          row_net: P6
        home:
          row_net: P5
        top:
          row_net: P4
    thumbfan:
      anchor:
        ref: matrix_inner_bottom
        shift: [-1.35kx, -1.68ky]
      columns:
        near:
          spread: spreadX
          origin: [3.6kx, 1.4ky]
          rotate: -3
          key:
            column_net: P19
        home:
          spread: spreadX + 1
          rotate: -15
          origin: [-kx, -0.9ky]
          key:
            column_net: P18
        far:
          spread: spreadX + 1
          rotate: -12.5
          origin: [-kx, -0.9ky]
          key:
            column_net: P15
      rows:
        thumb:
          row_net: P7
    bottom_encoder:
      anchor:
        ref: thumbfan_home_thumb
        shift: [1.9, 1.34ky]
      columns:
        far:
          key:
            column_net: P14
      rows:
        bottom:
          row_net: P6
outlines:
  exports:
    raw:
      - type: keys
        side: left
        size: [kx, ky]
        corner: px
    _glue:
      - type: polygon
        points:
          - ref: thumbfan_far_thumb
            shift: [0.62kx, 0.5 ky]
          - ref: thumbfan_far_thumb
            shift: [0.62kx, -0.5 ky]
          - ref: thumbfan_near_thumb
            shift: [0.5 px, -0.7 ky]
          - ref: matrix_pinky_bottom
            shift: [-0.5kx, -0.71ky]
          - ref: matrix_pinky_bottom
            shift: [-1.53kx, 0.4ky]
          - ref: matrix_pinky_top
            shift: [-0.7kx, 0.5ky]
          - ref: matrix_ring_top
            shift: [-0.6kx, 0.7ky]
          - ref: matrix_ring_top
            shift: [0.5kx, 0.72ky]
          - ref: matrix_ring_top
            shift: [0.51kx, 0.73ky]
          - ref: matrix_ring_top
            shift: [0.52kx, 0.74ky]
          - ref: matrix_inner_bottom
            shift: [39.8, -0.51ky]
          - ref: matrix_inner_bottom
            shift: [39.75, -0.52ky]
          - ref: matrix_inner_bottom
            shift: [38.6, -0.9ky]
    _controller_area:
      - type: polygon
        points:
          - ref: matrix_inner_top
            shift: [0.5555kx, 0.67ky]
          - ref: matrix_inner_top
            shift: [48, 0.826ky]
          - ref: matrix_inner_bottom
            shift: [39.8, -0.51ky]
          - ref: matrix_inner_bottom
            shift: [0.55kx, 0.05ky]
    _bottom_encoder_cutout:
      main:
        type: rectangle
        anchor:
          ref:
            - bottom_encoder_far_bottom
          shift: [-8.5, -11]
        size: [14, 17]
    _top_encoder_cutout:
      main:
        type: rectangle
        anchor:
          ref:
            - matrix_pinky_top_encoder
          shift: [-7.8, -7]
        size: [17, 14]
    _encoder_cutouts:
      - type: outline
        name: _bottom_encoder_cutout
      - type: outline
        name: _top_encoder_cutout
    _top_encoder_exclude:
      main:
        type: rectangle
        anchor:
          ref:
            - matrix_pinky_top_encoder
          # Shift 1 pixel on the right because key not centered
          shift: [-8.05, -7.4]
        size: [17.8, 14.8]
    _bottom_encoder_exclude:
      main:
        type: rectangle
        anchor:
          ref:
            - bottom_encoder_far_bottom
          shift: [-10, -11.75]
        size: [17, 22]
    _encoder_excludes:
      - type: outline
        name: _bottom_encoder_exclude
        fillet: 1px
      - type: outline
        name: _top_encoder_exclude
    _far_thumb_15U:
      main:
        type: rectangle
        anchor:
          ref:
            - thumbfan_far_thumb
          shift: [-0.5ky, -0.75kx]
        size: [ky, 1.5kx]
    _near_thumb_15U:
      main:
        type: rectangle
        anchor:
          ref:
            - thumbfan_near_thumb
          shift: [-0.5ky, -0.75kx]
        size: [ky, 1.5kx]
    _trackpad:
      pad:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [69.27, -7.52]
        radius: 17.5
    _screw_holes:
      top_left:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [-33.6, 14.24]
        radius: 1.1
      bottom_left:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [-52.81, -32.44]
        radius: 1.1
      top_right:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [30.09, 2.11]
        radius: 1.1
      bottom_right:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [29.92, -38.02]
        radius: 1.1
      thumb:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [66.31, -54.12]
        radius: 1.1
    _magnet_holes:
      top:
        type: circle
        anchor:
          - ref: matrix_inner_top
            shift: [0.3kx, 0]
        radius: 7.5
      center:
        type: circle
        anchor:
          - ref: matrix_pinky_home
            shift: [0, 0]
        radius: 7.5
      bottom:
        type: circle
        anchor:
          - ref: matrix_inner_bottom
            shift: [0.3kx, -1.25ky]
        radius: 7.5
    _puck_hole:
      center:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [9.225, -12.1]
        radius: 20.5
    _mounting_holes:
      $extends: outlines.exports._screw_holes
      top_left:
        radius: 1.9
      bottom_left:
        radius: 1.9
      top_right:
        radius: 1.9
      bottom_right:
        radius: 1.9
      thumb:
        radius: 1.9
    _guard_holes:
      guard_top:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [74.47, 16.55]
        radius: 1.1
      guard_bottom_left:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [53.02, -23.12]
        radius: 1.1
      guard_bottom_right:
        type: circle
        anchor:
          - ref: matrix_middle_home
            shift: [73.03, -29.66]
        radius: 1.1
    _pcb_holes:
      mounting_holes:
        type: outline
        name: _mounting_holes
        operation: add
      guard_holes:
        type: outline
        name: _guard_holes
        operation: add
    _switches:
      main:
        type: keys
        side: left
        size: 14 # 14mmx14mm cutouts will fit Choc and MX switches
        bound: false
    _keywell:
      main:
        type: outline
        name: raw
        fillet: 0.5
      _glue:
        type: outline
        name: _glue
        operation: add
        fillet: 4
    _base:
      main:
        type: outline
        name: _keywell
        fillet: 3
      controller_exclude:
        type: outline
        name: _controller_area
        operation: add
    _base_top:
      main:
        type: outline
        name: _keywell
        fillet: 3
      controller_exclude:
        type: outline
        name: _controller_area
        operation: subtract
    pcb:
      main:
        type: outline
        name: _base
        fillet: 2
    bottom_plate:
      main:
        type: outline
        name: pcb
      screw_holes:
        type: outline
        name: _screw_holes
        operation: subtract
      puck_hole:
        type: outline
        name: _puck_hole
        operation: subtract
      magnet_holes:
        type: outline
        name: _magnet_holes
        operation: subtract
    top_plate:
      main:
        type: outline
        name: _base_top
      switches:
        type: outline
        name: _switches
        operation: subtract
      screw_holes:
        type: outline
        name: _screw_holes
        operation: subtract
      encoder_exclude:
        type: outline
        name: _encoder_excludes
        operation: subtract
    keycaps:
      main:
        type: outline
        name: _base_top
      encoder_excludes:
        type: outline
        name: _encoder_excludes
        operation: subtract
      caps:
        type: keys
        side: left
        size: [capsX, capsY]
        bound: false
        corner: 1
        operation: stack
      near_thumb:
        type: outline
        name: _near_thumb_15U
        operation: stack
      far_thumb:
        type: outline
        name: _far_thumb_15U
        operation: stack
    preview:
      main:
        type: outline
        name: pcb
      top:
        type: outline
        name: top_plate
        operation: subtract
      guard_holes:
        type: outline
        name: _guard_holes
        operation: stack
      pcb_holes:
        type: outline
        name: _pcb_holes
        operation: stack
      puck_hole:
        type: outline
        name: _puck_hole
        operation: stack
      magnet_holes:
        type: outline
        name: _magnet_holes
        operation: stack
      encoder_cutouts:
        type: outline
        name: _encoder_cutouts
        operation: stack
      _trackpad:
        type: outline
        name: _trackpad
        operation: stack
      near_thumb:
        type: outline
        name: _near_thumb_15U
        operation: stack
      far_thumb:
        type: outline
        name: _far_thumb_15U
        operation: stack
cases:
  bottom_plate:
    - name: bottom_plate
      extrude: 3
      rotate: [0, 0, 0]
      shift: [0, 0, 0]
  top_plate:
    - name: top_plate
      extrude: 1.2
      rotate: [0, 0, 0]
      shift: [0, 0, 0]
